# Block Keeper License Attachment Flow

---
- [Prerequisites](#prerequisites)
- [Get Delegated License IDs and Signatures](#get-delegated-license-ids-and-signatures)
- [Create a Delegation Confirmation Signature](#create-a-delegation-confirmation-signature)
- [Update the Igniter Configuration File](#update-the-igniter-configuration-file)
---

**Note**:  
A maximum of 20 (twenty) licenses can be delegated to a single node.

To launch Igniter, you need a properly structured [signatures section](../config-template.yaml), which must be included in your configuration file.
To achieve this, three separate signatures must be generated:

- **License proof signature** (`license_proof_sig`) - proves the license is valid, generated by the Acki Nacki backend. Retrieved via API.
- **Delegation signature** (`delegation_sig`) - generated by License Owner. Retrieved via API or directly from License Owner. 
- **Delegation confirmation signature** (`delegation_confirm_sig`) -  confirmation signature generated by the Node Provider. 

## Prerequisites

- [latest tvm-cli](https://github.com/tvmlabs/tvm-sdk/releases)


## Get Delegated License IDs and Signatures

If licenses have been delegated via Dashboard, you can retrieve their `license_id`, `timestamp`, `license_proof_sig` and `delegation_sig` using the **REST API**, querying by the **License owner’s** and **Node Provider’s** public keys

Example API request:
```
curl 'https://dashboard.ackinacki.com/api/gossip/licenses/delegated?provider_pubkey=b8727272b106cd6b0712d18a747432577256e0a14f73e5a187a2f98e175034fc&license_owner_pubkey=7876682d123554aeedc71eb4e437e3c25ea8c9d97c0fd3fb9521061d6f494cdc'
```
Example API response:
```
[
  {
    "timestamp": 1736944335,
    "license_id": "2aebf602-7503-4572-976c-79f206f9b2c0",
    "license_owner_pubkey": "7876682d123554aeedc71eb4e437e3c25ea8c9d97c0fd3fb9521061d6f494cdc",
    "delegation_sig": "qwX6siO6q5jd7JFlcsc31maYdcL/XHgOuXqdS9UW9FPydvqmafMR78BvFrnJ6/7aT98ChLkaPuFf+PpYQczbCA==",
    "license_proof_sig": "4tvVKDRZPKOkV+bqTjUSEuNPP4zYio7kodo+UylCzvFCKEYUhGjF4VF5JbGzU/s2l98V31lMvBHKPv1yvw6dDg=="
  }
]
```


If licenses have been delegated without Dashboard, 

- get {`timestamp`, `license_id`, `delegation_sig` } from the License Owner. To do this, send them the link to the [Create a Delegation Signature (by License Owner) document](./Manual_license_delegation.md).
  
- get `license_proof_sig` via `api/gossip/licenses/proof` API

Example API request:
```
curl 'https://dashboard.ackinacki.com/api/gossip/licenses/proof?license_id=2aebf602-7503-4572-976c-79f206f9b2c0'
```
Example API response:
```
{"license_proof_sig":"4tvVKDRZPKOkV+bqTjUSEuNPP4zYio7kodo+UylCzvFCKEYUhGjF4VF5JbGzU/s2l98V31lMvBHKPv1yvw6dDg=="}
```


## Create a Delegation Confirmation Signature

Concatenate the following values in a **single line** (without spaces or newlines), then encode the result as a Base64 string:

  - `lisence_id`
  - `license_owner_pubkey`
  - `provider_pubkey`
  - `bk_node_owner_pubkey`
  - `bk_bls_pubkey`

**Note:**  
How to obtain bk_node_owner_pubkey and bk_bls_pubkey is described in detail in the [Generate BK Node Owner and BLS Keys document](./Keys_generation.md).

Example values:

```bash
license_id=2aebf602-7503-4572-976c-79f206f9b2c0
license_owner_pubkey=7876682d123554aeedc71eb4e437e3c25ea8c9d97c0fd3fb9521061d6f494cdc
provider_pubkey=b8727272b106cd6b0712d18a747432577256e0a14f73e5a187a2f98e175034fc
bk_node_owner_pubkey=3ef72c59a33ba75a484cfb126bd9e55db267cbd944110374d0b78a9e474c6c87
bk_bls_pubkey=8cf7d141cade81a44c8bc58a02b0448e85e77d47d9c644adfe3512d3c5fcdc2a028cfb96aff704a70f2cce27c96cd706

echo -n ${license_id}${license_owner_pubkey}${provider_pubkey}${bk_node_owner_pubkey}${bk_bls_pubkey} | base64 -w 0

```
**Note**:  
If you're using `zsh` you may see a `%` sign at the end of the output — this is just your shell prompt and not part of the Base64-encoded string.

Use tvm-cli to sign the Base64 string:

```
% tvm-cli sign \
    --keys node_provider_keys.json  \
    --data MmFlYmY2MDItNzUwMy00NTcyLTk3NmMtNzlmMjA2ZjliMmMwNzg3NjY4MmQxMjM1NTRhZWVkYzcxZWI0ZTQzN2UzYzI1ZWE4YzlkOTdjMGZkM2ZiOTUyMTA2MWQ2ZjQ5NGNkY2I4NzI3MjcyYjEwNmNkNmIwNzEyZDE4YTc0NzQzMjU3NzI1NmUwYTE0ZjczZTVhMTg3YTJmOThlMTc1MDM0ZmM=
```
Example Output:
```
Signature: 7+38qkyDgp9QOez0jmOeC2ahIp7025aV6bFfsE93BsZROBt+aa8YUamcIsjBYtolEYdpjhQBbH2OL/fQ90ZwAw==
```

This value is your `delegation_confirm_sig`.
Make sure to copy and save it for use in your configuration.

## Update the Igniter Configuration File

Fill in the `signatures` section of your `config.yaml` file using the signatures obtained in the previous steps as values for the fields `license_proof_sig`, `delegation_sig`, and `delegation_confirm_sig`.

Here is an example of how the section should look:
```
signatures:
  - license_id: 2aebf602-7503-4572-976c-79f206f9b2c0
    license_owner_pubkey: 7876682d123554aeedc71eb4e437e3c25ea8c9d97c0fd3fb9521061d6f494cdc
    provider_pubkey: b8727272b106cd6b0712d18a747432577256e0a14f73e5a187a2f98e175034fc
    license_proof_sig: 4tvVKDRZPKOkV+bqTjUSEuNPP4zYio7kodo+UylCzvFCKEYUhGjF4VF5JbGzU/s2l98V31lMvBHKPv1yvw6dDg==
    delegation_sig: qwX6siO6q5jd7JFlcsc31maYdcL/XHgOuXqdS9UW9FPydvqmafMR78BvFrnJ6/7aT98ChLkaPuFf+PpYQczbCA==
    delegation_confirm_sig: 7+38qkyDgp9QOez0jmOeC2ahIp7025aV6bFfsE93BsZROBt+aa8YUamcIsjBYtolEYdpjhQBbH2OL/fQ90ZwAw==
    timestamp: 1736944335
```